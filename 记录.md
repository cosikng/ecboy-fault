## 老加密软件 Easycode Boy Plus 解密成功但没有文件输出的解决办法

最近偶然在网盘里发现了一个 `.bfh` 加密文件，想起来是很久以前用 Easycode Boy Plus 加密的，就试着解密看看内容。结果显示**密码正确、解密成功**，但始终看不到解密后的文件输出。我折腾了两天才搞清楚原因，简单记录一下，希望能帮到有需要的人。

### 前提条件

如果你也遇到了**密码正确、显示解密成功但没有文件输出**的情况，先看一下加密文件大小是不是超过了 2GB。更准确地说，是否超过：

`2^31 - 1 + 288`

如果是，本方法适用。我推测该软件用 `int` 变量记录文件大小，超过 2GiB 后发生溢出，最终导致没有文件输出。

如果文件大小没有超过 2GiB，那更可能是文件损坏导致的无输出。你仍然可以尝试本文方法，但很可能无效或只能得到不完整文件。

### 原理

我没有完全逆向 `ecboy plus`，但通过 `Process Monitor` 基本搞清了它的解密逻辑：

* 解密时，软件会在加密文件同目录下创建一个同名的 `.$$$` 临时文件；
* 之后将数据解密并写入该临时文件；
* 解密完成后，把该临时文件重命名为元数据中记录的原文件名。

而解密失败时，最后不会执行重命名流程，而是直接删除 `.$$$` 临时文件。`Process Monitor` 显示程序已经向临时文件写入了与原文件大小相当的字节数，因此我推测：**解密本身已经完成**，只是因为文件大小溢出导致最后校验不通过，程序误以为文件损坏并删除了临时文件。

### 解决办法

既然明文很可能已经写到了磁盘上，我们只需要阻止程序最后的删除，或把数据同步拷到别处即可。最简单的办法是使用 Windows 的**硬链接**：相当于给同一份数据再创建一个文件名。这样即使解密程序删除了 `.$$$` 临时文件名，我们也能保住数据。

**注意：硬链接只能在同一块硬盘（同一分区）内创建。**
先确认你要解密的文件在哪个盘，然后在同一分区下随便找一个文件夹，右键选择“在终端中打开”，准备输入下面的命令（先别回车，后面说什么时候执行）：

`fsutil hardlink create '文件1' '文件2'`

* **文件1**：你要保存的硬链接文件名（随便起，例如 `D:\recovered.bin`）
* **文件2**：`ecboy plus` 解密时创建的临时文件路径（`.$$$` 文件）

举例：

* 要解密的文件是 `D:\file.bin`，则临时文件通常是 `D:\file.$$$`
* 如果加密时同步加密了文件名，比如 `D:\E5H1E2D7.bin`，则临时文件是 `D:\E5H1E2D7.$$$`

> 特别注意：在 PowerShell 中请用**英文单引号**把路径括起来，避免 `$` 被当作变量解析。

把命令输好后先不要回车。接着打开 `ecboy plus` 开始解密操作，出现等待窗口后立刻回到终端执行命令。正常的话会提示“硬连接已创建”。这一过程不必太紧张：解密 2GiB 以上文件通常需要二三十秒，时间足够执行命令。

软件提示解密成功后就可以关掉了。此时 **文件1** 就是保留下来的解密结果。文件名可能不是原来的名字：

* 如果你记得原文件类型，直接改扩展名即可打开；
* 如果完全不记得，可以用十六进制查看器看文件头，网上搜一下（或问 AI）判断格式，再改成对应扩展名打开。
